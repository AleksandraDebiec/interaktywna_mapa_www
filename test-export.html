<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test modułu eksportu</title>
</head>
<body>
    <h1>Test modułu eksportu tras</h1>
    <button id="testBtn">Testuj eksport</button>
    <div id="output"></div>

    <script>
        // Mock danych testowych
        window.showCustomModal = function({ title, message, confirmText, cancelText }) {
            return new Promise(resolve => {
                const result = confirm(`${title}\n\n${message}\n\nKliknij OK dla "${confirmText}" lub Anuluj dla "${cancelText}"`);
                resolve(result);
            });
        };

        const testData = {
            currentItem: {
                name: "Szlak testowy",
                properties: { name: "Szlak testowy" }
            },
            currentPath: {
                type: "Feature",
                geometry: {
                    type: "LineString",
                    coordinates: [
                        [16.28, 50.77],
                        [16.29, 50.78],
                        [16.30, 50.79]
                    ]
                }
            }
        };

        window.currentItem = testData.currentItem;
        window.currentPath = testData.currentPath;
    </script>

    <script src="./map_demo/js/lib/route-export.js"></script>
    <script src="./map_demo/js/lib/route-export-integration.js"></script>

    <script>
        document.getElementById('testBtn').addEventListener('click', async () => {
            const output = document.getElementById('output');
            output.innerHTML = '<p>Testuję eksport...</p>';
            
            try {
                // Sprawdź czy funkcje są dostępne
                output.innerHTML += `<p>downloadCurrentRouteNew: ${typeof downloadCurrentRouteNew}</p>`;
                output.innerHTML += `<p>RouteExporter: ${typeof RouteExporter}</p>`;
                output.innerHTML += `<p>currentItem: ${window.currentItem ? 'OK' : 'BRAK'}</p>`;
                output.innerHTML += `<p>currentPath: ${window.currentPath ? 'OK' : 'BRAK'}</p>`;
                
                if (typeof downloadCurrentRouteNew === 'function') {
                    await downloadCurrentRouteNew('kml');
                    output.innerHTML += '<p>✅ Eksport zakończony pomyślnie!</p>';
                } else {
                    output.innerHTML += '<p>❌ Funkcja downloadCurrentRouteNew nie jest dostępna</p>';
                }
            } catch (error) {
                output.innerHTML += `<p>❌ Błąd: ${error.message}</p>`;
                console.error('Błąd eksportu:', error);
            }
        });
    </script>
</body>
</html>